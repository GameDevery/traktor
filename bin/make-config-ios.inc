# Configuration file

# Toolchain and SDK configuration.
XCODE_PATH=$(shell xcode-select --print-path)
TOOLCHAIN_BIN=$(XCODE_PATH)/Toolchains/XcodeDefault.xctoolchain/usr/bin
SDK_SYSROOT=$(shell ls -d -1 $(XCODE_PATH)/Platforms/iPhoneOS.platform/Developer/SDKs/**)
SDK_SYSROOT_EMULATOR=$(shell ls -d -1 $(XCODE_PATH)/Platforms/iPhoneSimulator.platform/Developer/SDKs/**)
IPHONE_OS_MIN_VERSION=7.1

# Build tools.

# C
C=$(TOOLCHAIN_BIN)/clang

C_FLAGS_COMMON=-fmessage-length=0 -fdiagnostics-show-note-include-stack -fmacro-backtrace-limit=0 -fstrict-aliasing -fvisibility=hidden -fpascal-strings -miphoneos-version-min=$(IPHONE_OS_MIN_VERSION)

C_FLAGS_DEBUG_SHARED=$(C_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0 
C_FLAGS_DEBUG_SHARED_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_SHARED)
C_FLAGS_DEBUG_SHARED_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_SHARED)
C_FLAGS_DEBUG_SHARED_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_SHARED)
C_FLAGS_DEBUG_SHARED_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_DEBUG_SHARED)
C_FLAGS_DEBUG_SHARED_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_DEBUG_SHARED)

C_FLAGS_RELEASE_SHARED=$(C_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0 
C_FLAGS_RELEASE_SHARED_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_SHARED)
C_FLAGS_RELEASE_SHARED_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_SHARED)
C_FLAGS_RELEASE_SHARED_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_SHARED)
C_FLAGS_RELEASE_SHARED_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_RELEASE_SHARED)
C_FLAGS_RELEASE_SHARED_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_RELEASE_SHARED)

C_FLAGS_DEBUG_STATIC=$(C_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
C_FLAGS_DEBUG_STATIC_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_STATIC)
C_FLAGS_DEBUG_STATIC_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_STATIC)
C_FLAGS_DEBUG_STATIC_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_STATIC)
C_FLAGS_DEBUG_STATIC_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_DEBUG_STATIC)
C_FLAGS_DEBUG_STATIC_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_DEBUG_STATIC)

C_FLAGS_RELEASE_STATIC=$(C_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
C_FLAGS_RELEASE_STATIC_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_STATIC)
C_FLAGS_RELEASE_STATIC_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_STATIC)
C_FLAGS_RELEASE_STATIC_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_STATIC)
C_FLAGS_RELEASE_STATIC_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_RELEASE_STATIC)
C_FLAGS_RELEASE_STATIC_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_RELEASE_STATIC)

C_FLAGS_DEBUG_EXECUTABLE=$(C_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
C_FLAGS_DEBUG_EXECUTABLE_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_EXECUTABLE)
C_FLAGS_DEBUG_EXECUTABLE_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_EXECUTABLE)
C_FLAGS_DEBUG_EXECUTABLE_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(C_FLAGS_DEBUG_EXECUTABLE)
C_FLAGS_DEBUG_EXECUTABLE_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_DEBUG_EXECUTABLE)
C_FLAGS_DEBUG_EXECUTABLE_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_DEBUG_EXECUTABLE)

C_FLAGS_RELEASE_EXECUTABLE=$(C_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0 
C_FLAGS_RELEASE_EXECUTABLE_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_EXECUTABLE)
C_FLAGS_RELEASE_EXECUTABLE_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_EXECUTABLE)
C_FLAGS_RELEASE_EXECUTABLE_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(C_FLAGS_RELEASE_EXECUTABLE)
C_FLAGS_RELEASE_EXECUTABLE_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_RELEASE_EXECUTABLE)
C_FLAGS_RELEASE_EXECUTABLE_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(C_FLAGS_RELEASE_EXECUTABLE)

C_FLAG_OUTPUT=-o 

# C++
CC=$(TOOLCHAIN_BIN)/clang

CC_FLAGS_COMMON=-fmessage-length=0 -fdiagnostics-show-note-include-stack -fmacro-backtrace-limit=0 -fstrict-aliasing -fvisibility=hidden -fpascal-strings -miphoneos-version-min=$(IPHONE_OS_MIN_VERSION)

CC_FLAGS_DEBUG_SHARED=$(CC_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0 
CC_FLAGS_DEBUG_SHARED_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_SHARED)
CC_FLAGS_DEBUG_SHARED_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_SHARED)
CC_FLAGS_DEBUG_SHARED_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_SHARED)
CC_FLAGS_DEBUG_SHARED_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_DEBUG_SHARED)
CC_FLAGS_DEBUG_SHARED_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_DEBUG_SHARED)

CC_FLAGS_RELEASE_SHARED=$(CC_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0 
CC_FLAGS_RELEASE_SHARED_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_SHARED)
CC_FLAGS_RELEASE_SHARED_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_SHARED)
CC_FLAGS_RELEASE_SHARED_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_SHARED)
CC_FLAGS_RELEASE_SHARED_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_RELEASE_SHARED)
CC_FLAGS_RELEASE_SHARED_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_RELEASE_SHARED)

CC_FLAGS_DEBUG_STATIC=$(CC_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
CC_FLAGS_DEBUG_STATIC_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_STATIC)
CC_FLAGS_DEBUG_STATIC_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_STATIC)
CC_FLAGS_DEBUG_STATIC_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_STATIC)
CC_FLAGS_DEBUG_STATIC_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_DEBUG_STATIC)
CC_FLAGS_DEBUG_STATIC_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_DEBUG_STATIC)

CC_FLAGS_RELEASE_STATIC=$(CC_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
CC_FLAGS_RELEASE_STATIC_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_STATIC)
CC_FLAGS_RELEASE_STATIC_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_STATIC)
CC_FLAGS_RELEASE_STATIC_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_STATIC)
CC_FLAGS_RELEASE_STATIC_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_RELEASE_STATIC)
CC_FLAGS_RELEASE_STATIC_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_RELEASE_STATIC)

CC_FLAGS_DEBUG_EXECUTABLE=$(CC_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
CC_FLAGS_DEBUG_EXECUTABLE_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_EXECUTABLE)
CC_FLAGS_DEBUG_EXECUTABLE_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_EXECUTABLE)
CC_FLAGS_DEBUG_EXECUTABLE_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_DEBUG_EXECUTABLE)
CC_FLAGS_DEBUG_EXECUTABLE_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_DEBUG_EXECUTABLE)
CC_FLAGS_DEBUG_EXECUTABLE_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_DEBUG_EXECUTABLE)

CC_FLAGS_RELEASE_EXECUTABLE=$(CC_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0 
CC_FLAGS_RELEASE_EXECUTABLE_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_EXECUTABLE)
CC_FLAGS_RELEASE_EXECUTABLE_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_EXECUTABLE)
CC_FLAGS_RELEASE_EXECUTABLE_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(CC_FLAGS_RELEASE_EXECUTABLE)
CC_FLAGS_RELEASE_EXECUTABLE_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_RELEASE_EXECUTABLE)
CC_FLAGS_RELEASE_EXECUTABLE_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(CC_FLAGS_RELEASE_EXECUTABLE)

CC_FLAG_OUTPUT=-o 

# Objective/C
MM=$(TOOLCHAIN_BIN)/clang -x objective-c++

MM_FLAGS_COMMON=-fmessage-length=0 -fdiagnostics-show-note-include-stack -fmacro-backtrace-limit=0 -fstrict-aliasing -fvisibility=hidden -fpascal-strings -miphoneos-version-min=$(IPHONE_OS_MIN_VERSION)

MM_FLAGS_DEBUG_SHARED=$(MM_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
MM_FLAGS_DEBUG_SHARED_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_SHARED)
MM_FLAGS_DEBUG_SHARED_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_SHARED)
MM_FLAGS_DEBUG_SHARED_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_SHARED)
MM_FLAGS_DEBUG_SHARED_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_DEBUG_SHARED)
MM_FLAGS_DEBUG_SHARED_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_DEBUG_SHARED)

MM_FLAGS_RELEASE_SHARED=$(MM_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
MM_FLAGS_RELEASE_SHARED_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_SHARED)
MM_FLAGS_RELEASE_SHARED_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_SHARED)
MM_FLAGS_RELEASE_SHARED_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_SHARED)
MM_FLAGS_RELEASE_SHARED_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_RELEASE_SHARED)
MM_FLAGS_RELEASE_SHARED_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_RELEASE_SHARED)

MM_FLAGS_DEBUG_STATIC=$(MM_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
MM_FLAGS_DEBUG_STATIC_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_STATIC)
MM_FLAGS_DEBUG_STATIC_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_STATIC)
MM_FLAGS_DEBUG_STATIC_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_STATIC)
MM_FLAGS_DEBUG_STATIC_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_DEBUG_STATIC)
MM_FLAGS_DEBUG_STATIC_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_DEBUG_STATIC)

MM_FLAGS_RELEASE_STATIC=$(MM_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
MM_FLAGS_RELEASE_STATIC_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_STATIC)
MM_FLAGS_RELEASE_STATIC_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_STATIC)
MM_FLAGS_RELEASE_STATIC_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_STATIC)
MM_FLAGS_RELEASE_STATIC_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_RELEASE_STATIC)
MM_FLAGS_RELEASE_STATIC_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_RELEASE_STATIC)

MM_FLAGS_DEBUG_EXECUTABLE=$(MM_FLAGS_COMMON) -g -O0 -D _UNICODE -D UNICODE -D __IOS__ -DDEBUG=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
MM_FLAGS_DEBUG_EXECUTABLE_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_EXECUTABLE)
MM_FLAGS_DEBUG_EXECUTABLE_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_EXECUTABLE)
MM_FLAGS_DEBUG_EXECUTABLE_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_DEBUG_EXECUTABLE)
MM_FLAGS_DEBUG_EXECUTABLE_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_DEBUG_EXECUTABLE)
MM_FLAGS_DEBUG_EXECUTABLE_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_DEBUG_EXECUTABLE)

MM_FLAGS_RELEASE_EXECUTABLE=$(MM_FLAGS_COMMON) -g -O3 -D _UNICODE -D UNICODE -D __IOS__ -DNS_BLOCK_ASSERTIONS=1 -DOBJC_OLD_DISPATCH_PROTOTYPES=0
MM_FLAGS_RELEASE_EXECUTABLE_armv7=-arch armv7 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_EXECUTABLE)
MM_FLAGS_RELEASE_EXECUTABLE_armv7s=-arch armv7s -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_EXECUTABLE)
MM_FLAGS_RELEASE_EXECUTABLE_arm64=-arch arm64 -isysroot $(SDK_SYSROOT) $(MM_FLAGS_RELEASE_EXECUTABLE)
MM_FLAGS_RELEASE_EXECUTABLE_i386=-arch i386 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_RELEASE_EXECUTABLE)
MM_FLAGS_RELEASE_EXECUTABLE_x86_64=-arch x86_64 -isysroot $(SDK_SYSROOT_EMULATOR) $(MM_FLAGS_RELEASE_EXECUTABLE)

MM_FLAG_OUTPUT=-o 

# Archiver
AR=$(TOOLCHAIN_BIN)/libtool

#AR_FLAGS_COMMON=-static -syslibroot $(SDK_SYSROOT)
AR_FLAGS_COMMON=-static
AR_FLAGS_DEBUG_STATIC=$(AR_FLAGS_COMMON)
AR_FLAGS_RELEASE_STATIC=$(AR_FLAGS_COMMON)

AR_FLAG_OUTPUT=-o 

# Linker
LINK=$(TOOLCHAIN_BIN)/clang $(CC_FLAGS_COMMON)
LINK_FLAG_OUTPUT=-o 
LINK_LIBS=

# Binary include
BINARY_INCLUDE=BinaryInclude
