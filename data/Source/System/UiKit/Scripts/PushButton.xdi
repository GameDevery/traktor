<?xml version="1.0" encoding="utf-8"?>
<object type="traktor.script.Script" version="2">
	<text>
	<![CDATA[
#using \{40191BBE-DDD0-0E47-92A9-66AF2CEC0F6F}

import(traktor.flash)

-- PushButton

PushButton = PushButton or inherit(Widget)
PushButton_meta = PushButton_meta or { name = "PushButton", __index = PushButton }

function PushButton.new(parent, caption)
	local o = {}
	setmetatable(o, PushButton_meta)

	local mc = Widget._createResource(parent, "MC_PushButton")

	o:_initialize(parent, mc, caption)
	return o
end

function PushButton:getPreferredSize()
	return self._preferredSize
end

function PushButton:setColor(color)
	self._background_mc:setColorTransform(ColorTransform(
		color,
		Color4f(0, 0, 0, 0)
	))
	return self
end

function PushButton:setCaption(s)
	self._caption_tb:parseText(s)
	return self
end

function PushButton:setEnable(enable)
	self._enable = enable
	if self._enable then
		self._mc:setProperty("_alpha", 100)
	else
		self._mc:setProperty("_alpha", 50)
	end
	return self
end

function PushButton:isEnabled()
	return self._enable
end

function PushButton:setOnClick(fn)
	self._clickFn = fn
	return self
end

-- Private

function PushButton:_initialize(parent, mc, caption)
	Widget._initialize(self, parent, mc)

	self._background_mc = mc:getMember("background_mc")
	self._caption_tb = mc:getMember("caption_tb")

	self._margin = self._caption_tb:getX()
	self._preferredSize =
	{
		width = mc:getWidth(),
		height = mc:getHeight()
	}

	self._enable = true
	self._clickFn = nil

	self:_registerEvent("onPress", function() self:_onPress() end)
	self:_registerEvent("onRelease", function() self:_onRelease() end)
	self:_registerEvent("onMouseUp", function() self:_onMouseUp() end)

	self:setCaption(caption)
end

function PushButton:_onPress()
	if self._enable then
		self._background_mc:gotoAndStop("down")
	end
end

function PushButton:_onRelease()
	if self._enable and self._clickFn ~= nil then
		self._clickFn()
	end
end

function PushButton:_onMouseUp()
	if self._enable then
		self._background_mc:gotoAndStop("up")
	end
end

	]]>
	</text>
</object>
